<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html lang="en"> 
<head> 
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"> 
	<title>Hexagonal Grid Test</title> 
	<style type="text/css" media="screen">
		body { background:#eee }
		#grid { margin:0 auto; width:1024px; height:768px; position:relative }
		#grid canvas { border:2px solid #333; background:#fff; }
		#output { position:absolute; top:1px; right:0px; padding:0.1em 0.5em; text-align:right; background:rgba(255, 255, 255, .8); }
		#offense, #defense { font-size:9pt; font-weight:bold; position:absolute; bottom:0; margin:0; right:0 }
		#offense { left:0; right:auto }
		
	</style>
	<script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="../js/cell.js"></script>
	<script type="text/javascript" src="../js/board.js"></script>
	<script type="text/javascript">
		// Hex Grid
		COL_OFFSET = 13.27;
		COL_WIDTH  = 41.567;
		CEL_OFFSET = 24;
		CEL_HEIGHT = 48;
		
		// MN grid coordinates
		MAX_M      = 22;
		MAX_N      = 15;

		// Graphic size
		HEX_WIDTH  = 55;
		HEX_HEIGHT = 48;

		$tiles = {};
		var names = "hexgrid border lightblue lightyellow orange black green red".split(" ");
		for (var i=names.length-1;i>=0;--i){
			$tiles[names[i]] = new Image;
			$tiles[names[i]].src = '../img/'+names[i]+'.png';
		}
		
		onload = function(){
			$('#defense,#offense').mousedown(function(){
				$board.path=[];
				$board.mode=this.id;
				$board.redraw();
			});

			$board = new Board( MAX_M, MAX_N, $('canvas')[0], $tiles );
			$board.start  = (new Cell( -1, 5 )).useTile('green');
			$board.finish = (new Cell( 23, -10)).useTile('red');

			// Fill the board with random holes
			// for (var i=0;i<50;i++){
			// 	var m=Math.floor( Math.random()*MAX_M );
			// 	var n=Math.floor( Math.random()*MAX_N );
			// 	var hole = Cell.fromMN(m,n);
			// 	$board.placeHole(hole);
			// }

			var lastCell = null;
			$('#grid').mousemove(function(e){
				if ($board.mode=='defense') return;
				var cell = Cell.fromXY(
					e.clientX - this.offsetLeft,
					e.clientY - this.offsetTop
				);
				
				if ($board.inBounds(cell)){
					if (!lastCell || !lastCell.sameAs(cell)){
						lastCell = cell;
						$board.path = [];
						var p1,p2;
						if (p1 = $board.shortestPath($board.start,cell)){
							if (p2 = $board.shortestPath(cell,$board.finish)){
								for (var i=0,len=p1.length-1;i<len;++i){
									p1[i].tile='lightyellow';
									$board.path[i]=p1[i];
								}
								p1[i].tile = 'orange';
								$board.path[i]=p1[i];
								for (var i=0,len=p2.length-1;i<len;++i){
									p2[i].tile='lightyellow';
									$board.path.push(p2[i]);
								}
								$('#output').html( $board.path.length );
							}
						}
					}
				}
				$board.redraw();
			}).mousedown(function(e){
				var cell = Cell.fromXY(
					e.clientX - this.offsetLeft,
					e.clientY - this.offsetTop
				);
				switch($board.mode){
					case 'defense':
						$board.placeHole(cell);
					break;
				}
			});
			
			$board.redraw();
		}
		
	</script> 
</head> 
<body>
<div id="grid">
	<div id="output">?SUP?</div>
	<button id="offense">offense</button>
	<button id="defense">defense</button>
	<canvas width="1024" height="768"></canvas>
</div>
</body></html>