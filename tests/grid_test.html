<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html lang="en"> 
<head> 
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"> 
	<title>Hexagonal Grid Test</title> 
	<style type="text/css" media="screen">
		body { background:#eee }
		#grid { margin:0 auto; width:1024px; position:relative }
		#grid canvas { border:1px solid #999; background:#fff; }
		#highlight { position:absolute; left:48px; top:111px; display:none }
	</style>
	<script type="text/javascript">
		// Hex Grid
		COL_OFFSET = 13.27;
		COL_WIDTH  = 41.567;
		CEL_OFFSET = 24;
		CEL_HEIGHT = 48;
		
		// Board
		WIDTH      = 1024;
		HEIGHT     = 768;

		// Graphic size
		HEX_WIDTH  = 55;
		HEX_HEIGHT = 48;

		bg     = new Image; bg.src    ='../img/hexgrid.png';
		border = new Image; border.src='../img/border.png';
		blue   = new Image; blue.src  ='../img/lightblue.png';
		yellow = new Image; yellow.src='../img/lightyellow.png';
		orange = new Image; orange.src='../img/orange.png';
		black  = new Image; black.src ='../img/black.png';
		green  = new Image; green.src ='../img/green.png';
		red    = new Image; red.src   ='../img/red.png';

		onload = function(){
			grid = document.getElementById('grid');
			cnv  = grid.getElementsByTagName('canvas')[0];
			ctx  = cnv.getContext('2d');
			grid.onmousemove=handleMove;
			clearPath();
			for (var i=0;i<9;++i) path.push({a:i,b:0,c:0});
			for (var i=0;i<5;++i) path.push({a:9,b:i,c:0});
			for (var i=0;i<7;++i) path.push({a:9,b:5,c:-i});
			updateGrid();
		}
		
		function handleMove(e){
			var snapped;
			var pointer = { x:e.clientX - grid.offsetLeft, y:e.clientY - grid.offsetTop };
			if (pointer.x>=0 && pointer.x<=WIDTH && pointer.y>=0 && pointer.y<=HEIGHT){
				snapped = xy2abc( pointer );
			}
			updateGrid(snapped);
		};
		
		function abc2xy(abc){
			var x=COL_OFFSET+(abc.a+abc.c+1)*COL_WIDTH;
			var y=CEL_OFFSET+(abc.a+2*abc.b-abc.c+1)*CEL_HEIGHT/2;
			return {x:x,y:y};
		}
		function xy2abc(xy){
			var a = Math.round( ( xy.x - COL_OFFSET - COL_WIDTH ) / COL_WIDTH );
			var b = Math.round( ( xy.y - CEL_OFFSET - (a+1)*CEL_HEIGHT/2 ) / CEL_HEIGHT );
			return {a:a,b:b,c:0};
		}
		
		function clearPath(){ path=[]; }
		function updateGrid(point){
			// Don't update if snapping to the same cell
			if (point && last && last.a==point.a && last.b==point.b && last.c==point.c) return;
			if (point){
				point.color = yellow;
				path.push( point );
			} 
			last=point;

			ctx.clearRect(0,0,1024,768);
			ctx.drawImage( border, 0, 0 );
			for ( var i=path.length-1; i>=0; --i ){
				var point = path[i];
				var xy    = abc2xy(point);
				var color = point.color || blue;
				ctx.drawImage( color, xy.x-HEX_WIDTH/2-1, xy.y-HEX_HEIGHT/2-0.5 );
			} 
			ctx.drawImage( bg, 0, 0 );
		}
		
	</script> 
</head> 
<body>
<div id="grid">
	<canvas width="1024" height="768"></canvas>
</div>
</body></html>