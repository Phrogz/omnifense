<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html lang="en"> 
<head> 
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"> 
	<title>Hexagonal Grid Test</title> 
	<style type="text/css" media="screen">
		body { background:#eee }
		#grid { margin:0 auto; width:1024px; position:relative }
		#grid canvas { border:1px solid #999; background:#fff; }
		#highlight { position:absolute; left:48px; top:111px; display:none }
	</style>
	<script type="text/javascript">
		COL_OFFSET = 13.21;
		COL_WIDTH  = 41.567;
		CEL_OFFSET = 24;
		CEL_HEIGHT = 48;
		WIDTH      = 1024;
		HEIGHT     = 768;

		HEX_WIDTH  = 55;
		HEX_HEIGHT = 48;

		bg     = new Image; bg.src    ='../img/hexgrid.png';
		blue   = new Image; blue.src  ='../img/lightblue.png';
		yellow = new Image; yellow.src='../img/lightyellow.png';
		orange = new Image; orange.src='../img/orange.png';
		black  = new Image; black.src ='../img/black.png';

		onload = function(){
			grid = document.getElementById('grid');
			cnv  = grid.getElementsByTagName('canvas')[0];
			ctx  = cnv.getContext('2d');
			grid.onmousemove=handleMove;
			clearPath();
			updateGrid();
		}
		
		function handleMove(e){
			var pointer = { x:e.clientX - grid.offsetLeft, y:e.clientY - grid.offsetTop };
			var column = Math.round((pointer.x-COL_OFFSET)/COL_WIDTH);
			var snapped = {	x:column*COL_WIDTH+COL_OFFSET };
			var yOffset = (column%2 == 0) ? CEL_OFFSET : 0;
			snapped.y   = Math.round((pointer.y-yOffset)/CEL_HEIGHT)*CEL_HEIGHT+yOffset;
			if (pointer.x<0 || pointer.x>WIDTH || pointer.y<0 || pointer.y>HEIGHT) snapped=null;
			updateGrid(snapped);
		};
		
		function clearPath(){ path=[]; }
		function updateGrid(point){
			// Don't update if snapping to the same cell
			if (point && last && last.x==point.x && last.y==point.y) return;
			ctx.clearRect(0,0,1024,768);
			if (point) path.push( point );
			//if (point) path = [ point ];
			for ( var i=path.length-1; i>=0; --i ) ctx.drawImage( blue, path[i].x-HEX_WIDTH/2, path[i].y-HEX_HEIGHT/2 );
			ctx.drawImage( bg, 0, 0 );
			last=point;
		}
		
	</script> 
</head> 
<body>
<div id="grid">
	<canvas width="1024" height="768"></canvas>
</div>
</body></html>